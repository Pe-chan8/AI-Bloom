<% content_for :title, "投稿一覧 - AI-bloom" %>

<div class="max-w-3xl mx-auto pt-6 space-y-4">
  <h1 class="text-lg font-semibold">投稿一覧</h1>

  <% if @posts.any? %>
    <div class="space-y-4">
      <% @posts.each do |post| %>
        <div class="bg-white rounded-2xl shadow-sm px-4 py-3">
          <div class="flex items-center justify-between text-xs text-slate-500 mb-2">
            <span>
              <% datetime = post.posted_at || post.created_at %>
              <%= l datetime, format: :short %>
            </span>

            <div class="flex items-center gap-2">
              <%# mood %>
              <% if post.mood.present? %>
                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[10px] bg-sky-50 text-sky-700 border border-sky-100">
                  気分: <%= post.mood_i18n rescue post.mood %>
                </span>
              <% end %>

              <%# visibility %>
              <% if post.visibility.present? %>
                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[10px] bg-amber-50 text-amber-700 border border-amber-100">
                  <%= post.visibility_private? ? "非公開" : "公開" %>
                </span>
              <% end %>
            </div>
          </div>

          <div class="text-sm text-slate-800 whitespace-pre-wrap break-words">
            <%= simple_format(post.body) %>
          </div>

          <div class="mt-3 flex justify-end gap-2">
            <%= link_to "編集する",
                        edit_post_path(post),
                        class: "text-xs px-3 py-1.5 rounded-full border border-slate-300 text-slate-700 hover:bg-slate-50" %>

            <%= button_to "削除",
                  post_path(post),
                  method: :delete,
                  data: { turbo_confirm: "本当にこの投稿を削除しますか？" },
                  class: "text-xs px-3 py-1.5 rounded-full border border-rose-300 text-rose-600 hover:bg-rose-50" %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- ページネーション -->
    <% if @posts.total_pages > 1 %>
    <div class="mt-10 flex justify-center">
        <div class="flex items-center gap-2">

        <!-- 前へ -->
        <% if @posts.prev_page %>
            <%= link_to "◀", url_for(page: @posts.prev_page), 
                class: "px-3 py-1.5 rounded-full bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 text-sm" %>
        <% else %>
            <span class="px-3 py-1.5 rounded-full bg-slate-100 text-slate-400 text-sm cursor-default">◀</span>
        <% end %>

        <!-- ページ番号 -->
        <% @posts.total_pages.times do |i| %>
            <% page_num = i + 1 %>

            <% if page_num == @posts.current_page %>
            <span class="px-3 py-1.5 rounded-full bg-sky-500 text-white text-sm font-semibold">
                <%= page_num %>
            </span>
            <% else %>
            <%= link_to page_num,
                    url_for(page: page_num),
                    class: "px-3 py-1.5 rounded-full bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 text-sm" %>
            <% end %>
        <% end %>

        <!-- 次へ -->
        <% if @posts.next_page %>
            <%= link_to "▶", url_for(page: @posts.next_page),
                class: "px-3 py-1.5 rounded-full bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 text-sm" %>
        <% else %>
            <span class="px-3 py-1.5 rounded-full bg-slate-100 text-slate-400 text-sm cursor-default">▶</span>
        <% end %>

        </div>
    </div>
    <% end %>

  <% else %>
    <div class="bg-white rounded-2xl shadow-sm px-4 py-6 text-center text-sm text-slate-500">
      まだ投稿がありません。<br>
      右下の<strong>「新規投稿」</strong>ボタンから、今日の気持ちを残してみましょう 🌻
    </div>
  <% end %>
</div>
